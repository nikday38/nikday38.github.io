<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copyright Vision Pro | –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* ... (–≤—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... */
    </style>
</head>
<body>
    <div class="floating-particles" id="particles"></div>
    
    <div class="container">
        <div class="header">
            <h1>üîç Copyright Vision Pro</h1>
            <p>–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º</p>
        </div>

        <div class="main-content">
            <!-- ... (–æ—Å—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
        </div>

        <div class="controls-panel">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</h3>
            
            <div class="slider-container">
                <label>
                    –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <span class="slider-value" id="sensitivity-value">15</span>%
                </label>
                <input type="range" id="sensitivity" min="5" max="30" value="15" onchange="updateSliderValue('sensitivity', 'sensitivity-value')">
                <div style="color: rgba(255,255,255,0.8); font-size: 0.9em; margin-top: 10px;">
                    –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è = –º–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
                </div>
            </div>

            <div class="slider-container">
                <label>
                    –†–∞–∑–º–µ—Ä –±–ª–æ–∫–∞: <span class="slider-value" id="block-size-value">16</span>px
                </label>
                <input type="range" id="block-size" min="4" max="32" step="4" value="16" onchange="updateSliderValue('block-size', 'block-size-value')">
                <div style="color: rgba(255,255,255,0.8); font-size: 0.9em; margin-top: 10px;">
                    –†–∞–∑–º–µ—Ä –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                </div>
            </div>

            <div class="slider-container">
                <label>
                    –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å: <span class="slider-value" id="min-area-value">100</span>px¬≤
                </label>
                <input type="range" id="min-area" min="20" max="500" value="100" onchange="updateSliderValue('min-area', 'min-area-value')">
                <div style="color: rgba(255,255,255,0.8); font-size: 0.9em; margin-top: 10px;">
                    –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–ª–∫–∏–µ —Ä–∞–∑–ª–∏—á–∏—è
                </div>
            </div>

            <div class="button-group">
                <button class="button" id="compare-btn" onclick="startAnalysis()" disabled>
                    üöÄ –ù–∞—á–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑
                </button>
                <button class="button button-secondary" onclick="resetAnalysis()">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- ... (–æ—Å—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
    </div>

    <script>
        // ... (—á–∞—Å—Ç–∏—Ü—ã –∏ –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...

        function calculateStructuralDifference(block1, block2, blockSize) {
            // –í—ã—á–∏—Å–ª—è–µ–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –¥–ª—è –±–ª–æ–∫–æ–≤
            const hist1 = new Array(64).fill(0);
            const hist2 = new Array(64).fill(0);
            
            for (let i = 0; i < block1.length; i += 4) {
                // –ö–≤–∞–Ω—Ç—É–µ–º —Ü–≤–µ—Ç–∞ –≤ 4 –±–∏—Ç–∞ –Ω–∞ –∫–∞–Ω–∞–ª (64 —Ü–≤–µ—Ç–∞ –≤—Å–µ–≥–æ)
                const r1 = Math.floor(block1[i] / 64);
                const g1 = Math.floor(block1[i + 1] / 64);
                const b1 = Math.floor(block1[i + 2] / 64);
                const colorIndex1 = (r1 << 4) | (g1 << 2) | b1;
                
                const r2 = Math.floor(block2[i] / 64);
                const g2 = Math.floor(block2[i + 1] / 64);
                const b2 = Math.floor(block2[i + 2] / 64);
                const colorIndex2 = (r2 << 4) | (g2 << 2) | b2;
                
                hist1[colorIndex1]++;
                hist2[colorIndex2]++;
            }
            
            // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Å –ø–æ–º–æ—â—å—é —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –ë—Ö–∞—Ç—Ç–∞—á–∞—Ä–∏—è
            let similarity = 0;
            for (let i = 0; i < 64; i++) {
                similarity += Math.sqrt(hist1[i] * hist2[i]);
            }
            
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∏ –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º (1 - similarity = difference)
            const maxSimilarity = blockSize * blockSize;
            return 1 - (similarity / maxSimilarity);
        }

        function findEdges(imageData, width, height) {
            // –ü—Ä–æ—Å—Ç–æ–π –¥–µ—Ç–µ–∫—Ç–æ—Ä –∫—Ä–∞–µ–≤ Sobel
            const edges = new Uint8ClampedArray(width * height);
            const data = imageData.data;
            
            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    const idx = (y * width + x) * 4;
                    
                    // –í—ã—á–∏—Å–ª—è–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã
                    let gx = 0, gy = 0;
                    
                    for (let dy = -1; dy <= 1; dy++) {
                        for (let dx = -1; dx <= 1; dx++) {
                            const nidx = ((y + dy) * width + (x + dx)) * 4;
                            const gray = 0.3 * data[nidx] + 0.59 * data[nidx + 1] + 0.11 * data[nidx + 2];
                            
                            gx += gray * dx;
                            gy += gray * dy;
                        }
                    }
                    
                    // –í–µ–ª–∏—á–∏–Ω–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
                    const magnitude = Math.sqrt(gx * gx + gy * gy);
                    edges[y * width + x] = magnitude > 50 ? 255 : 0;
                }
            }
            
            return edges;
        }

        function analyzeImagesWithDifferences(sensitivity, blockSize, minArea) {
            try {
                updateProgress(10, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...');

                const canvas1 = document.createElement('canvas');
                const canvas2 = document.createElement('canvas');
                const ctx1 = canvas1.getContext('2d');
                const ctx2 = canvas2.getContext('2d');

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                const width = 800;
                const height = Math.floor((width / image1.naturalWidth) * image1.naturalHeight);

                canvas1.width = canvas2.width = width;
                canvas1.height = canvas2.height = height;

                updateProgress(30, '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...');
                ctx1.drawImage(image1, 0, 0, width, height);
                ctx2.drawImage(image2, 0, 0, width, height);

                updateProgress(50, '–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑...');
                
                const imageData1 = ctx1.getImageData(0, 0, width, height);
                const imageData2 = ctx2.getImageData(0, 0, width, height);

                // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —Ä–∞–∑–ª–∏—á–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
                const diffMap = new Uint8ClampedArray(width * height);
                let differentBlocks = 0;
                const totalBlocks = Math.floor(width / blockSize) * Math.floor(height / blockSize);

                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –±–ª–æ–∫–∞–º–∏
                for (let y = 0; y < height - blockSize; y += blockSize) {
                    for (let x = 0; x < width - blockSize; x += blockSize) {
                        const blockData1 = ctx1.getImageData(x, y, blockSize, blockSize).data;
                        const blockData2 = ctx2.getImageData(x, y, blockSize, blockSize).data;
                        
                        const difference = calculateStructuralDifference(blockData1, blockData2, blockSize);
                        
                        if (difference > sensitivity) {
                            differentBlocks++;
                            // –ü–æ–º–µ—á–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫ –∫–∞–∫ —Ä–∞–∑–ª–∏—á–Ω—ã–π
                            for (let by = 0; by < blockSize; by++) {
                                for (let bx = 0; bx < blockSize; bx++) {
                                    const px = x + bx;
                                    const py = y + by;
                                    if (px < width && py < height) {
                                        diffMap[py * width + px] = 255;
                                    }
                                }
                            }
                        }

                        updateProgress(50 + Math.floor((y * width + x) / (width * height) * 30), 
                                    `–ê–Ω–∞–ª–∏–∑ –±–ª–æ–∫–æ–≤: ${Math.round((y * width + x) / (width * height) * 100)}%`);
                    }
                }

                updateProgress(80, '–ü–æ–∏—Å–∫ –∑–Ω–∞—á–∏–º—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π...');
                
                // –ù–∞—Ö–æ–¥–∏–º —Å–≤—è–∑–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
                differenceAreas = findConnectedComponents(diffMap, width, height, minArea);

                // –°–æ–∑–¥–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const resultCanvas = document.createElement('canvas');
                resultCanvas.width = width;
                resultCanvas.height = height;
                const resultCtx = resultCanvas.getContext('2d');
                
                // –†–∏—Å—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                resultCtx.drawImage(canvas1, 0, 0);

                // –û–±–≤–æ–¥–∏–º –¢–û–õ–¨–ö–û –∑–Ω–∞—á–∏–º—ã–µ –æ–±–ª–∞—Å—Ç–∏ —Ä–∞–∑–ª–∏—á–∏–π
                resultCtx.strokeStyle = '#ff4757';
                resultCtx.lineWidth = 3;
                resultCtx.fillStyle = 'rgba(255, 71, 87, 0.1)';
                
                differenceAreas.forEach(area => {
                    let minX = width, minY = height, maxX = 0, maxY = 0;
                    for (const [x, y] of area) {
                        minX = Math.min(minX, x);
                        minY = Math.min(minY, y);
                        maxX = Math.max(maxX, x);
                        maxY = Math.max(maxY, y);
                    }
                    
                    // –†–∏—Å—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±–ª–∞—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–∞—è
                    if ((maxX - minX) * (maxY - minY) >= minArea) {
                        resultCtx.beginPath();
                        resultCtx.rect(minX, minY, maxX - minX, maxY - minY);
                        resultCtx.stroke();
                        resultCtx.fill();
                    }
                });

                updateProgress(95, '–†–∞—Å—á–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏...');

                const totalPixels = width * height;
                const changedPixels = diffMap.reduce((sum, val) => sum + (val === 255 ? 1 : 0), 0);
                const similarity = ((totalPixels - changedPixels) / totalPixels) * 100;
                const similarityRounded = Math.max(0, Math.min(100, Math.round(similarity * 10) / 10));
                const analysisTime = ((Date.now() - startTime) / 1000).toFixed(1);

                analysisResult = {
                    similarity: similarityRounded,
                    diffCanvas: resultCanvas,
                    totalPixels: totalPixels,
                    changedPixels: changedPixels,
                    areasCount: differenceAreas.length,
                    analysisTime: analysisTime,
                    resolution: `${width}√ó${height}px`,
                    differentBlocks: differentBlocks,
                    totalBlocks: totalBlocks
                };

                updateProgress(100, '–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!');
                
                setTimeout(() => {
                    document.getElementById('progress-container').style.display = 'none';
                    displayResult();
                }, 500);

            } catch (error) {
                console.error('Analysis error:', error);
                showError('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: ' + error.message);
                document.getElementById('progress-container').style.display = 'none';
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displayResult() {
            if (!analysisResult) return;

            // ... (–æ—Å—Ç–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è displayResult –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...

            detailedStats.innerHTML = `
                <p><strong>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞:</strong> ${analysisResult.resolution}</p>
                <p><strong>–í—Å–µ–≥–æ –ø–∏–∫—Å–µ–ª–µ–π:</strong> ${analysisResult.totalPixels.toLocaleString()}</p>
                <p><strong>–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–∏–∫—Å–µ–ª–∏:</strong> ${analysisResult.changedPixels.toLocaleString()}</p>
                <p><strong>–†–∞–∑–ª–∏—á–Ω—ã–µ –±–ª–æ–∫–∏:</strong> ${analysisResult.differentBlocks}/${analysisResult.totalBlocks}</p>
                <p><strong>–û–±–ª–∞—Å—Ç–µ–π —Ä–∞–∑–ª–∏—á–∏–π:</strong> ${analysisResult.areasCount}</p>
                <p><strong>–ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ö–æ–∂–µ—Å—Ç–∏:</strong> ${analysisResult.similarity.toFixed(2)}%</p>
                <p><strong>–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:</strong> ${analysisResult.analysisTime} —Å–µ–∫—É–Ω–¥</p>
                <p><strong>–ú–µ—Ç–æ–¥:</strong> –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–ª–æ–∫–æ–≤</p>
            `;

            // ... (–æ—Å—Ç–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function startAnalysis() {
            if (!image1 || !image2) return;

            startTime = Date.now();
            const sensitivity = parseInt(document.getElementById('sensitivity').value) / 100;
            const blockSize = parseInt(document.getElementById('block-size').value);
            const minArea = parseInt(document.getElementById('min-area').value);

            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            hideError();

            setTimeout(() => {
                analyzeImagesWithDifferences(sensitivity, blockSize, minArea);
            }, 100);
        }

        // ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
    </script>
</body>
</html>
